# TCP/IP 모델
<img width="1256" alt="TCP:IP" src="https://user-images.githubusercontent.com/107941880/220852069-78167aea-be2b-4ba4-935c-d7f6d4a9a4b5.png">

TCP/IP는 패킷 통신 방식의 인터넷 프로토콜인 IP(Internet Protocol)와 전송 제어 프로토콜인 TCP(Transmission Control Protocol)로 이루어져 있습니다.

IP는 패킷 전달 여부를 보증하지 않고, 패킷을 보낸 순서와 받는 순서가 다를 수 있습니다. TCP는 IP 위에서 동작하는 프로토콜로, 데이터의 전달을 보증하고 보낸 순서대로 받게 해줍니다. HTTP, FTP, SMTP 등 TCP를 기반으로 한 많은 애플리케이션 프로토콜들이 IP 위에서 동작합니다. 즉, 모든 애플리케이션과 기기들이 공통으로 사용하는 TCP와 IP가 프로토콜 조합의 중심이 되기 때문에 TCP/IP 모델이라고 부르는 것입니다.

## 계층 5.  응용 계층(Application Layer)

- 사용자의 데이터와 직접 상호 작용하는 유일한 계층입니다.
- 애플리케이션 계층은 소프트웨어가 사용자에게 의미 있는 데이터를 제공하기 위해 의존하는 프로토콜과 데이터를 조작하는 역할을 합니다.
- ex) HTTP, FTP, SMTP, DNS 등

## 계층 4. 전송 계층(Transport Layer)

- `Port 번호`를 사용하여 도착지 컴퓨터의 최종 도착지인 프로세스까지 데이터가 도달하게 합니다.
- 송신자와 수신자의 논리적 연결(Connection)을 담당하는 부분으로, 신뢰성 있는 연결을 유지할 수 있도록 도와줍니다.
- 즉, Endpoint(사용자) 간의 연결을 생성하고 데이터를 얼마나 보내고 받았는지, 제대로 받았는지 등을 확인합니다.
- ex) TCP, UDP
- 엄밀히 말하자면, TCP의 데이터 전송 단위는 `세그먼트(Segment)`이고, UDP의 데이터 전송 단위는 `데이터그램(Datagram)`입니다.

> ### 💡 전송 계층의 프로토콜: TCP와 UDP

- TCP와 UDP의 주요 차이점은 데이터 전송의 `신뢰성` 과 `연결성` 입니다.
- **TCP(Transmission Control Protocol)**
    - 연결 지향 프로토콜로, 두 호스트(데이터를 송수신하고 애플리케이션을 실행시키는 컴퓨터) 간에 신뢰성 있고 안정적인 통신 채널을 구축합니다.
    - TCP를 통해 데이터를 전송할 때 데이터는 세그먼트(Segment)라는 작은 단위로 나뉩니다. 각 세그먼트에는 TCP 헤더와 데이터 페이로드가 포함됩니다.
    - TCP 헤더에는 SYN, ACK, FIN과 같은 제어 플래그와 Source Port, Destination Port, Sequence Number, Window Size와 같은 정보가 포함되어 있습니다.
    - TCP는 `3-way handshake`를 통해 두 호스트의 전송 계층 사이의 논리적 연결을 설정하며, 안정적인 데이터 전송을 보장하기 위해 `흐름 제어` 및 `혼잡 제어` 메커니즘을 구현합니다.
- **UDP(User Datagram Protocol)**
    - 비연결형, 비신뢰성 전송 프로토콜연결이 없는 프로토콜입니다.
    - UDP를 통해 데이터가 전송되면 데이터그램(Datagram)이라는 작은 단위로 나뉩니다. 각 데이터그램에는 UDP 헤더와 데이터 페이로드가 포함됩니다.
    - UDP 헤더에는 Source Port, Destination Port, 데이터그램의 길이 등의 정보가 포함되지만, 흐름 제어 및 혼잡 제어, 안정성과 관련된 정보는 포함하지 않습니다.
- TCP는 오류 확인, 흐름 제어, 혼잡 제어 등 복잡한 메커니즘을 사용하여 데이터가 올바르게 전달되도록 합니다. 반면 UDP는 이러한 메커니즘을 제공하지 않으며 소량의 패킷 손실이 허용되는 실시간 애플리케이션에 자주 사용됩니다.

> ### 💡 TCP의 통신 과정 **(연결 → 데이터 전송 → 연결 해제)**

- **연결(3-way handshake)**
    1. 클라이언트가 연결하고 싶다는 `SYN(Synchronize)` 메시지를 서버에 보냅니다.
    2. 서버는 SYN 메시지를 수신했으며 연결을 설정할 의향이 있음을 나타내는 `SYN + ACK(Acknowledge)` 메시지로 응답합니다.
    3. 클라이언트는 서버에 `ACK(확인)` 메시지를 전송하여 SYN+ACK 메시지를 수신했으며 통신할 준비가 되었음을 알립니다.
- **데이터 전송**
- **연결 해제(4-way handshake)**
    1. 클라이언트는 데이터 전송을 완료했음을 나타내는 `FIN(Finish)` 메시지를 서버에 보냅니다.
    2. 서버가 FIN 메시지를 수신했음을 나타내는 `ACK` 메시지로 응답합니다.
    3. 서버는 데이터 전송을 완료했음을 나타내는 `FIN` 메시지를 클라이언트에 보냅니다.
    4. 클라이언트는 FIN 메시지를 수신했음을 나타내는 `ACK` 메시지로 응답합니다.

  ⇒ 4-way handshake가 완료되면 클라이언트와 서버는 모두 TCP 연결을 닫고 더 이상 데이터를 교환하지 않습니다.


> ### 💡 TCP의 **흐름 제어와 혼잡 제어**

- **흐름 제어**
    - 만약 데이터를 송신하는 곳에서 수신하는 곳이 감당할 수 없을만큼 많은 데이털르 빠르게 보내면 수신하는 곳에서 문제가 발생합니다.
    - 흐름 제어는 데이터를 송신하는 곳과 수신하는 곳의 데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지합니다.
    - TCP Header에는 `Sequence Number`, `Window Size` 등의 정보가 있습니다.
    - `Sequence Number`는 데이터의 첫 번째 바이트 위치를 식별하는 번호이며, 수신자는 이를 통해 데이터의 순서를 지킬 수 있습니다.
    - `Window size` 는 수신자가 정하는 일정량의 데이터 크기이며,  상황에 따라 조절할 수 있습니다.
    - 데이터를 받으면 수신자는 지금까지 받은 데이터 양을 확인하여 송신자에게 보내는데 이를 `Acknowledgment Number` 라고 합니다.

      예를 들어 수신자가 `Sequence Number` 500까지의 모든 데이터를 성공적으로 수신한 경우, 수신자는 `Acknowledgment Number` 가 501인 승인 세그먼트를 전송합니다. 이는 발신자에게 이제 `Sequence Number` 501부터 데이터 전송을 시작할 수 있음을 알립니다.

- **혼잡 제어**
    - 데이터를 주고 받는 Endpoint도 중요하지만 데이터가 지나가는 네트워크망의 혼잡도 또한 중요합니다.
    - 따라서 네트워크 내의 데이터 수가 과하지 않게 전송량을 조절하여 혼잡 붕괴 현상이 일어나는 것을 막습니다.

## 계층 3. 네트워크 계층(Network Layer)

- 서로 다른 두 네트워크 간 데이터 전송을 용이하게 하는 역할을 합니다.
- 수많은 네트워크들의 연결로 이루어지는 inter-network 속에서 어딘가에 있는 목적지 컴퓨터로 데이터를 전송하기 위해, `IP 주소`를 이용해서 길을 찾습니다.
- 데이터가 표적에 도달하기 위한 최상의 물리적 경로를 찾는 것을 라우팅(Routing)이라고 합니다.
- ex) IP
- 데이터 전송 단위는 `Datagram(또는 Packet)` 입니다.

> ### 💡 네트워크 계층의 프로토콜 : IP(Internet Protocol)

- **IP(Internet Protocol)**
    - 인터넷의 여러 네트워크에서 데이터 패킷을 중계하는 데 사용되는 주요 통신 프로토콜입니다.
    - 비연결성, 비신뢰성의 특징으로 인해 패킷이 손실되거나 중복되거나 순서와 다르게 도착할 수 있습니다.
        - 비연결성: 패킷을 받을 대상이 없거나 서비스 불능 상태이더라도 패킷을 전송한다.
        - 비신뢰성: 중간에 패킷이 손실되거나 전송 순서가 섞일 수도 있다.
    - 하지만 다양한 물리적 매체에서 작동하도록 설계되었으며, 간단하고 확장 가능하며 분산된 주소 체계를 제공합니다.
- **IP Address(IP 주소)**
    - 인터넷에 연결된 각 장치에 할당된 고유 식별자입니다.
    - 인터넷을 통해 한 장치에서 다른 장치로 데이터 패킷을 라우팅하는 데 사용됩니다.
    - IPv4의 경우 32비트, IPv6의 경우 128비트로 구성되며 일반적으로 192.168.0.1과 같이 점으로 구분된 10진수 표기법으로 표시됩니다.
    - 하지만 특정 사이트를 접속하기 위해 IP 주소를 전부 외워 입력해야 하는 것은 매우 불편하고 비효율적입니다. 이에 따라, DNS(Domain Name System)이 등장하였습니다.
- **DNS(Domain Name System)**
    - 사람이 읽을 수 있는 도메인 이름(예: [www.example.com](http://www.example.com/))을 해당 IP 주소에 매핑하는 계층적이고 분산된 명명 시스템입니다.
    - DNS 서버는 도메인 이름과 관련 IP 주소의 데이터베이스를 유지 관리하고 이름 확인을 요청하는 클라이언트의 DNS 쿼리(query)에 응답합니다.

## 계층 2. 데이터 링크 계층(Data Link Layer)

- 같은 네트워크 대역을 사용하는 단말들에 대해 신뢰성 있는 전송을 보장합니다.
- 즉 `MAC Address`를 사용하여 같은 구간 내의 Endpoint 혹은 Switching 장비에 전달하며, 물리 계층(계층 1)에서 생길 수 있는 오류를 찾아냅니다.
- ex) Ethernet(이더넷)
- 데이터 전송 단위는 `Frame` 입니다.

## 계층 1. 물리 계층(Physical Layer)

- `Cable`로 대표되는 물리적인 계층으로, 전기적 신호가 전송되는 구간입니다.
- 0과 1의 문자열인 비트 스트림을 아날로그 신호로 바꾸어 전선으로 흘려 보내고(encoding), 아날로그 신호가 들어오면 비트 스트림으로 변환(decoding)합니다.
- 물리적으로 연결된 두 대의 컴퓨터가 0과 1의 나열을 주고 받을 수 있게 합니다.
- 데이터 전송 단위는 Bit 입니다.

---

### Reference

- [TCP/IP 쉽게 이해하기](https://aws-hyoh.tistory.com/57)
